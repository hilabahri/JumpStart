<!DOCTYPE html>
<html lang="en">
<head>
    <title>Home</title>
    <meta charset="utf-8"> 
    <link rel="stylesheet" type="text/css" media="screen" href="~/css/grid_12.css">
    <link rel="stylesheet" type="text/css" media="screen" href="~/css/style.css">
    <link href='http://fonts.googleapis.com/css?family=Lato:300italic' rel='stylesheet' type='text/css'>
    <link href="~/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="~/css/shCore.css" rel="stylesheet" />
    <link href="~/css/magnific-popup.css" rel="stylesheet" />
    <link href="~/css/requestModal.css" rel="stylesheet" />
    <script src="~/js/jquery-1.7.min.js"></script>
    <script src="~/js/jquery.easing.1.3.js"></script>
    <script src="~/js/cufon-yui.js"></script>
    <script src="~/js/cufon-replace.js"></script>
    <script src="~/js/Bilbo_400.font.js"></script>
    <script src="~/js/tms-0.4.1.js"></script>
    <script src="~/js/Table/jquery.dataTables.min.js"></script>
    <script src="~/js/Table/shCore.js"></script>
    <script src="~/js/jquery.magnific-popup.min.js"></script>


    <!--[if lt IE 8]>
       <div style=' clear: both; text-align:center; position: relative;'>
         <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
           <img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." />
        </a>
      </div>
    <![endif]-->
    <!--[if lt IE 9]>
        <script type="text/javascript" src="js/html5.js"></script>
        <link rel="stylesheet" type="text/css" media="screen" href="css/ie.css">
    <![endif]-->
</head>
<body>
    <header>
        <div>
            <div>
                <h1><a href="index.html"><img src="~/images/logo.jpg" alt=""></a></h1>
                <nav>
                    <ul class="menu">
                        <li class="current"><a href="#">Donor</a></li>
                        <li><a class="popup-with-form" href="#addFunds-form">Add funds</a></li>
                        <li><a href="~/Donated/Index">Donated</a></li>
                    </ul>
                </nav>
                <div class="clear"></div>
            </div>
        </div>
    </header>

    <script>
        //Globals
        var donatedId;
        var courseId;
        var donatorId = '5579f6d6052921397816ce61';

        $(document).ready(function () {
            $('.popup-with-form').magnificPopup({
                type: 'inline',
                preloader: false,
                focus: '#name',

                // When elemened is focused, some mobile browsers in some cases zoom in
                // It looks not nice, so we disable it:
                callbacks: {
                    beforeOpen: function () {
                        if ($(window).width() < 700) {
                            this.st.focus = false;
                        } else {
                            this.st.focus = '#name';
                        }
                    }
                }
            });


            var requestsTable = $('#RequestsTable').dataTable({
                "ajax": "Home/GetFundingRequestsMetaData",
                "columns": [
                    { "data": "course" },
                    { "data": "age" },
                    { "data": "city" },
                    { "data": "collectedAmount" },
                    { "data": "goalAmount" },
                    { "data": "donaterID"},
                    {"data": "courseID"}
                ]
            }).ajaxComplete(function () {
                var table = document.getElementById("RequestsTable");
                var rows = table.getElementsByTagName("tr");
                for (i = 0; i < rows.length; i++) {
                    var currentRow = table.rows[i];
                    var createClickHandler =
                        function (row) {
                            return function () {
                                var cols = [];
                                var cell = row.getElementsByTagName("td");
                                for (var col in cell) {
                                    cols.push(cell[col].innerHTML);
                                }
                                rowClick(cols);
                            };
                        };

                    currentRow.onclick = createClickHandler(currentRow);
                }
            });

        });

        function rowClick(currentRow) {
            $.magnificPopup.open({
                items: {
                    src: '#test-form'
                },
                type: 'inline'
            }, 0);

            var data = {};
            data.donatedID = currentRow[5];
            data.courseID = currentRow[6];

            donatedId = currentRow[5];
            courseId = currentRow[6];

            $.ajax({
                type: "POST",
                url: "Home/GetFundingRequestData",
                data: data,
                //success: success,
                datatype: "json"
            }).success(function (data) {
                data = JSON.parse(data);
                var firstName = data.firstName;
                var lastName = data.lastName;
                if (firstName == undefined)
                {
                    firstName = '****';
                    lastName = '****';
                }
                $('#test-form').html('<center><b>First name:</b> ' + firstName + ' <b>Last name:</b> ' + lastName + ' <b>City:</b> ' + data.address.city + '<br/><b>Description:</b> ' + data.description + '<br/><b>Gender:</b> ' + data.gender + ' <b>Age:</b> ' + data.age + '<br/><b>Course:</b> ' + data.course + "<br/><b>Collected Amount:</b> " + data.collectedAmount + " <b>Goal Amount:</b> " + data.goalAmount + '<br/><b>Credit card number:</b> <input id="cardNumber" value="0"/><br/><b>Amount to donate:</b> <input id="amountToDonate"/>' + '<button onclick="CommitDonate()">Donate</button></center>');
            });
        }

        function CommitDonate()
        {
            var data = {};
            data.donatorId = donatorId;
            data.courseId = courseId;
            data.donatedId = donatedId;
            data.cardNumber = document.getElementById("cardNumber").value;
            data.value = document.getElementById("amountToDonate").value;

            $.ajax({
                type: "POST",
                url: "Home/NewTransaction",
                data: data,
                //success: success,
                datatype: "json"
            }).success(function () {
                alert('Transfer accepted');
            });
        }

        function fundsToAdd() {
            var data = {};
            data.donatorId = donatorId;
            data.courseId = courseId;
            data.donatedId = donatedId;
            data.cardNumber = document.getElementById("cardNumber").value;
            data.value = document.getElementById("amountToDonate").value;

            $.ajax({
                type: "POST",
                url: "Home/NewTransaction",
                data: data,
                //success: success,
                datatype: "json"
            }).success(function () {
                alert('Transfer accepted');
            });
        }
        </script>

    <!--==============================content================================-->
    <section id="content">
        <div class="ic">More Website Templates TemplateMonster.com. June 25, 2012!</div>
        <div class="container_12">
            <div class="grid_6 box-1">
                <img src="images/page1-img1.png" alt="">
                <div class="extra-wrap">
                    <h2>Who We Are</h2>
                    <p>Start-Up is one of <a href="http://blog.templatemonster.com/free-website-templates/" class="link" target="_blank">free website templates</a> created by TemplateMonster.com team. It’s optimized for 1280X1024 screen resolution.</p>
                </div>
            </div>
            <div class="grid_6 box-1">
                <img src="images/page1-img2.png" alt="">
                <div class="extra-wrap">
                    <h2>Starting Up...</h2>
                    <p>The PSD source files of this <a href="http://blog.templatemonster.com/2012/06/25/free-website-template-jquery-slider-business/" class="link">Start-Up Template</a> are available for free for the registered members of TemplateMonster.com.</p>
                </div>
            </div>
            <div class="grid_12 box-2">
                <div>
                    <table id="RequestsTable" class="display" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>Purpose</th>
                                <th>Age</th>
                                <th>Living Place</th>
                                <th>Collected</th>
                                <th>Goal</th>
                                <th>User ID</th>
                                <th>Request ID</th>
                            </tr>
                        </thead>

                        <tfoot>
                            <tr>
                                <th>Purpose</th>
                                <th>Age</th>
                                <th>Living Place</th>
                                <th>Collected</th>
                                <th>Goal</th>
                                <th>User ID</th>
                                <th>Request ID</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <div class="grid_8">
                <h2 class="top-1">Our Ideas</h2>
                <div class="box-3">
                    <div>
                        <img src="images/page1-img3.jpg" alt="" class="img-border">
                        <a href="#" class="link-2">Nam liber tempor</a>
                        <p>Uwisi eniminim veniam quis nostrud exerci tation ullamcorperex eacom.</p>
                    </div>
                    <div>
                        <img src="images/page1-img4.jpg" alt="" class="img-border">
                        <a href="#" class="link-2">Cum soluta nobis</a>
                        <p>Duis autem vel eum iriure dolor henrerit vulputate velit esse molestie.</p>
                    </div>
                    <div class="last">
                        <img src="images/page1-img5.jpg" alt="" class="img-border">
                        <a href="#" class="link-2">Eleifend optiongue</a>
                        <p>Feugiat nulla facilisis atvero eros et accumsan et iusto odio dignissim.</p>
                    </div>
                </div>
                <a href="#" class="button top-4">Read More</a>
            </div>
            <div class="grid_4">
                <h2 class="top-1">Latest Events</h2>
                <div class="box-4 top-2">
                    <div class="date"><strong>29</strong><span>May, 2012</span></div>
                    <p><a href="#" class="link">Lorem ipsum dolor sit amet consetetur</a><br>Sadipscing elitriam nonumy eirmod nonumy eirmod tempor invidunt labore.</p>
                </div>
                <div class="box-4 top-3">
                    <div class="date"><strong>21</strong><span>May, 2012</span></div>
                    <p><a href="#" class="link">Dolore magna aliquyam erat dolor</a><br>At vero eos et accusam et justo duo dolores et ea rebum stet clita kasd gubergren.</p>
                </div>
                <a href="#" class="button top-4">Read More</a>
            </div>
            <div class="clear"></div>
        </div>


        <div id="addFunds-form" class="white-popup-block mfp-hide" style="width: 360px;">
            <b>Funds to add: </b> <input id="fundsToAdd"/>
            <button onclick="addFunds()">Add</button>
        </div>

        <!-- form itself -->
        <div id="test-form" class="white-popup-block mfp-hide">
        </div>



    </section>
    <!--==============================footer=================================-->
    <footer>
        <p>© 2012 Start-Up<br> <a rel="nofollow" href="http://www.templatemonster.com/" target="_blank" class="link">Website Template</a>  by TemplateMonster.com</p> | <a rel="nofollow" href="http://www.html5xcss3.com/" target="_blank" class="link">Html5xcss3.com</a>
        <div class="soc-icons"><span>Follow Us:</span><a href="#"><img src="images/icon-1.jpg" alt=""></a><a href="#"><img src="images/icon-2.jpg" alt=""></a><a href="#"><img src="images/icon-3.jpg" alt=""></a></div>
    </footer>
</body>
</html>